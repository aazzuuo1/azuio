<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>صفحة الإحالة</title>
</head>
<body>

<h2>رابط الإحالة الخاص بك:</h2>
<p id="referralLink">جاري التحميل...</p>

<h2>عدد الأشخاص الذين سجلوا من رابطك:</h2>
<p id="referralCount">جاري التحميل...</p>

<script>
// رابط السكربت الخاص بك
const scriptURL = 'https://script.google.com/macros/s/AKfycbzlTXObl1qq2MGTGM_aJI4yR1S44vMVmh2wf9niYxBVN2t-R7fxuuCnGvvbktFo86zOQQ/exec';

// قراءة البريد وكود الإحالة من التخزين المحلي
const email = localStorage.getItem('email');
const referralCode = localStorage.getItem('referralCode');

// لو ما لقى بيانات، يرجعه لصفحة التسجيل
if (!email || !referralCode) {
  alert('الرجاء تسجيل الدخول أولا');
  window.location.href = 'index.html';
}

// إنشاء رابط الإحالة
const referralLink = window.location.origin + '/index.html?ref=' + referralCode;
document.getElementById('referralLink').textContent = referralLink;

// جلب عدد الإحالات من Google Sheets
fetch(`${scriptURL}?action=getReferrals&referralCode=${referralCode}`)
  .then(response => response.json())
  .then(data => {
    if (data && data.count !== undefined) {
      document.getElementById('referralCount').textContent = data.count + ' إحالة';
    } else {
      document.getElementById('referralCount').textContent = '0 إحالات';
    }
  })
  .catch(error => {
    console.error('خطأ في جلب البيانات:', error);
    document.getElementById('referralCount').textContent = 'خطأ في التحميل';
  });
</script>

</body>
</html>
